<section>
<h2 onclick="toggleSection(this)">互动小工具</h2>
<div class="content-collapsible">
<p class="detail">离线可用互动工具，帮助患者进行认知训练和健康记录：</p>

<h3>1. 随机记忆题</h3>
<p>系统随机显示 3 个词汇，记住后输入正确顺序：</p>
<button onclick="startMemoryTest()">生成词汇</button>
<p id="memoryWords" style="font-weight:bold;margin:5px 0;"></p>
<input type="text" id="memoryInput" placeholder="按顺序输入词汇，用空格分隔"/>
<button onclick="checkMemory()">提交</button>
<p id="memoryResult"></p>

<h3>2. 简单选择题</h3>
<p>请选择正确答案：</p>
<div id="quizArea"></div>
<button onclick="checkQuiz()">提交答案</button>
<p id="quizResult"></p>

<h3>3. 简单逻辑训练</h3>
<p>判断以下说法是否正确：</p>
<div id="logicArea"></div>
<button onclick="checkLogic()">提交答案</button>
<p id="logicResult"></p>

<h3>4. 日常健康记录</h3>
<textarea id="healthLog" rows="4" placeholder="记录今日活动、饮食、情绪等..."></textarea>
<button onclick="saveLog()">保存记录</button>
<p id="logResult"></p>
</div>
</section>

<script>
// 互动小游戏逻辑
// ---------- 随机记忆 ----------
const memoryWordsList = ["苹果","书本","椅子","花朵","太阳","雨伞","猫","狗","手表"];
let currentMemory = [];

function startMemoryTest(){
  currentMemory = [];
  while(currentMemory.length<3){
    let word = memoryWordsList[Math.floor(Math.random()*memoryWordsList.length)];
    if(!currentMemory.includes(word)) currentMemory.push(word);
  }
  document.getElementById('memoryWords').innerText = currentMemory.join('   ');
  document.getElementById('memoryResult').innerText = '请记住词汇，然后输入顺序';
}

function checkMemory(){
  const input = document.getElementById('memoryInput').value.trim().split(/\s+/);
  if(input.join() === currentMemory.join()){
    document.getElementById('memoryResult').innerText = '恭喜，记忆正确！';
  } else {
    document.getElementById('memoryResult').innerText = '记忆错误，正确答案是：'+currentMemory.join(' ');
  }
}

// ---------- 简单选择题 ----------
const quizQuestions = [
  {q:"阿尔茨海默病最常见的症状是？",options:["记忆力下降","高血压","视力模糊"],answer:0},
  {q:"预防阿尔茨海默病的有效方法是？",options:["健康饮食","完全卧床","不运动"],answer:0}
];

function renderQuiz(){
  const area = document.getElementById('quizArea');
  area.innerHTML = '';
  quizQuestions.forEach((item,i)=>{
    const div = document.createElement('div');
    div.innerHTML = `<p>${i+1}. ${item.q}</p>`+item.options.map((opt,j)=>`<label><input type="radio" name="q${i}" value="${j}"/> ${opt}</label>`).join('<br>')+'<br>';
    area.appendChild(div);
  });
}

function checkQuiz(){
  let correct = 0;
  quizQuestions.forEach((item,i)=>{
    const selected = document.querySelector(`input[name=q${i}]:checked`);
    if(selected && parseInt(selected.value)===item.answer) correct++;
  });
  document.getElementById('quizResult').innerText = `你答对了 ${correct}/${quizQuestions.length} 题`;
}

// ---------- 简单逻辑训练 ----------
const logicQuestions = [
  {q:"所有老年痴呆患者都会完全丧失记忆。",answer:false},
  {q:"适量运动对认知功能有益。",answer:true}
];

function renderLogic(){
  const area = document.getElementById('logicArea');
  area.innerHTML = '';
  logicQuestions.forEach((item,i)=>{
    const div = document.createElement('div');
    div.innerHTML = `<p>${i+1}. ${item.q}</p>`+
    `<label><input type="radio" name="lq${i}" value="true"/> 正确</label> <label><input type="radio" name="lq${i}" value="false"/> 错误</label><br>`;
    area.appendChild(div);
  });
}

function checkLogic(){
  let correct = 0;
  logicQuestions.forEach((item,i)=>{
    const selected = document.querySelector(`input[name=lq${i}]:checked`);
    if(selected && ((selected.value==="true")===item.answer)) correct++;
  });
  document.getElementById('logicResult').innerText = `你答对了 ${correct}/${logicQuestions.length} 道逻辑题`;
}

// ---------- 日常健康记录 ----------
function saveLog(){
  const log = document.getElementById('healthLog').value.trim();
  if(log){
    localStorage.setItem('healthLog', log);
    document.getElementById('logResult').innerText = '记录已保存（离线可用）';
  }else document.getElementById('logResult').innerText = '请输入内容再保存';
}

// ---------- 页面初始化 ----------
window.onload = ()=>{
  // 折叠初始化
  document.querySelectorAll('.content-collapsible').forEach(c=>c.style.display='none');
  // 加载本地健康记录
  const saved = localStorage.getItem('healthLog');
  if(saved) document.getElementById('healthLog').value = saved;
  // 渲染选择题与逻辑题
  renderQuiz();
  renderLogic();
};
</script>
